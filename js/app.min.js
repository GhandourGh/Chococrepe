const SUPABASE_URL="https://swqjfrcukhsxadjpuubs.supabase.co";const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3cWpmcmN1a2hzeGFkanB1dWJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1NzE1OTYsImV4cCI6MjA2NzE0NzU5Nn0.8xUXDCGlrHcnsmlE5GgRGLtu-SSWZDHOvI52nfgqXV0";const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);const menuSections=document.getElementById("menuSections");async function fetchMenuItems(){const{data:data,error:error}=await supabase.from("menu_items").select("*").order("category").order("subcategory").order("name");if(error&&menuSections){menuSections.innerHTML='<p class="error">Failed to load menu.</p>';return[]}return data}if(menuSections){const DRINK_SUBCATEGORIES=["Milkshakes","Smoothies","Cocktails","Fresh Juice","Coffee & More","Beverages"];const CATEGORY_MAP={crepes:"Crepes",desserts:"Desserts",cups:"Cups",sticks:"Sticks","ice-cream":"Ice Cream",drinks:"Drinks","add-ons":"Add-ons",shisha:"Shisha"};function getImageUrl(imagePath){if(!imagePath)return"";return`${SUPABASE_URL}/storage/v1/object/public/menu-images/${imagePath}`}function renderMenu(items,filterCategory=null){menuSections.innerHTML="";const grouped={};items.forEach(item=>{const catKey=(item.category||"").toLowerCase().replace(/\s+/g,"-");if(!grouped[catKey])grouped[catKey]={};const subcat=item.subcategory||"Other";if(!grouped[catKey][subcat])grouped[catKey][subcat]=[];grouped[catKey][subcat].push(item)});Object.entries(CATEGORY_MAP).forEach(([catKey,catLabel])=>{const section=document.createElement("section");section.className="menu-section closed";section.id=catKey;section.innerHTML=`\n      <div class="menu-section__header">\n        <h2 class="menu-section__title">${catLabel}</h2>\n        <button class="menu-section__toggle" aria-label="Toggle ${catLabel}">\n          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          </svg>\n        </button>\n      </div>`;if(grouped[catKey]){Object.entries(grouped[catKey]).forEach(([subcat,items],subIdx)=>{let subcatId=`${catKey}-subcat-${subIdx}`;let subcatToggle="";if(catKey==="drinks"&&subcat!=="Other"){subcatToggle=`<button class="menu-subsection__toggle" aria-label="Toggle ${subcat}"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>`;section.innerHTML+=`<div class="menu-subsection closed" id="${subcatId}" style="display:none;"><div class="menu-subsection__header"><h3 class="menu-subsection__title">${subcat}</h3>${subcatToggle}</div>`}const itemsDiv=document.createElement("div");itemsDiv.className="menu-items";items.forEach(item=>{itemsDiv.innerHTML+=`\n            <article class="menu-item">\n              <img src="${getImageUrl(item.image_path)}" alt="${item.name}" class="menu-item__image" loading="lazy">\n              <div class="menu-item__content">\n                <div class="menu-item__header">\n                  <h3 class="menu-item__name">${item.name}</h3>\n                </div>\n                <p class="menu-item__description">${item.description||""}</p>\n                <div class="menu-item__footer">\n                  <span class="menu-item__price">$${item.price.toFixed(2)}</span>\n                </div>\n              </div>\n            </article>\n          `});if(catKey==="drinks"&&subcat!=="Other"){section.innerHTML+=`</div>`;section.appendChild(itemsDiv);section.innerHTML+=`</div>`}else{section.appendChild(itemsDiv)}})}else{const emptyDiv=document.createElement("div");emptyDiv.className="menu-items menu-items--empty";emptyDiv.innerHTML=`<div style="color:var(--textSecondary);opacity:0.7;padding:24px 0;text-align:center;font-weight:500;">No items in this category yet.</div>`;section.appendChild(emptyDiv)}menuSections.appendChild(section)});setupMenuItemModal();setupMenuSectionToggles();setupMenuSubsectionToggles()}(async()=>{const items=await fetchMenuItems();renderMenu(items)})();supabase.channel("public:menu_items").on("postgres_changes",{event:"*",schema:"public",table:"menu_items"},async payload=>{const items=await fetchMenuItems();renderMenu(items)}).subscribe()}function setupHeroVideoCarousel(){const videos=document.querySelectorAll(".hero-video");let currentVideoIndex=0;let autoPlayInterval;function showVideo(index){videos.forEach(video=>video.classList.remove("active"));videos[index].classList.add("active");const currentVideo=videos[index];const playPromise=currentVideo.play();if(playPromise!==undefined){playPromise.catch(error=>{console.warn("Video autoplay failed:",error);document.addEventListener("click",()=>currentVideo.play(),{once:true})})}videos.forEach((video,i)=>{if(i!==index){video.pause()}});currentVideoIndex=index}function nextVideo(){const nextIndex=(currentVideoIndex+1)%videos.length;showVideo(nextIndex)}function prevVideo(){const prevIndex=(currentVideoIndex-1+videos.length)%videos.length;showVideo(prevIndex)}function startAutoPlay(){autoPlayInterval=setInterval(nextVideo,8e3)}function stopAutoPlay(){if(autoPlayInterval){clearInterval(autoPlayInterval)}}const heroSection=document.querySelector(".hero");heroSection.addEventListener("mouseenter",stopAutoPlay);heroSection.addEventListener("mouseleave",startAutoPlay);startAutoPlay();videos.forEach(video=>{video.addEventListener("loadstart",()=>{video.classList.add("loading")});video.addEventListener("canplay",()=>{video.classList.remove("loading");video.classList.add("loaded")});video.addEventListener("error",()=>{console.warn("Video failed to load:",video.src);video.classList.remove("loading");if(video.classList.contains("active")){nextVideo()}})})}document.addEventListener("DOMContentLoaded",()=>{const videos=document.querySelectorAll(".hero-video");if(videos.length>0){setupHeroVideoCarousel()}});window.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hero-video").forEach(video=>{video.loop=true})});let cart=JSON.parse(localStorage.getItem("chocoCart"))||[];window.cart=cart;const cartButton=document.querySelector(".cart-btn");const cartBadge=document.getElementById("cartBadge");const cartModal=document.getElementById("cart-modal");if(cartButton&&cartBadge&&cartModal){const cartModalOverlay=cartModal.querySelector(".cart-modal__overlay");const cartModalClose=cartModal.querySelector(".cart-modal__close");const cartModalItems=cartModal.querySelector(".cart-modal__items");const cartModalTotal=cartModal.querySelector(".cart-modal__total-value");const cartModalClear=cartModal.querySelector(".cart-modal__clear");function updateCartBadge(){const count=cart.reduce((sum,item)=>sum+item.qty,0);if(count>0){cartBadge.textContent=count;cartBadge.classList.add("show")}else{cartBadge.classList.remove("show")}localStorage.setItem("chocoCart",JSON.stringify(cart))}window.updateCartBadge=updateCartBadge;function renderCartModal(){cartModalItems.innerHTML="";if(cart.length===0){cartModalItems.innerHTML='<div style="text-align:center;color:var(--textSecondary);font-weight:600;">Your cart is empty.</div>';cartModalTotal.textContent="$0.00";return}let total=0;cart.forEach((item,idx)=>{const itemPrice=typeof item.price==="number"&&!isNaN(item.price)?item.price:0;total+=item.qty*itemPrice;const el=document.createElement("div");el.className="cart-modal__item";el.innerHTML=`\n            <img src="${item.img}" alt="${item.name}" class="cart-modal__item-img" />\n            <div class="cart-modal__item-info">\n                <div class="cart-modal__item-name">${item.name}</div>\n                <div class="cart-modal__item-qty">Qty: ${item.qty}</div>\n                <div class="cart-modal__item-price">$${(itemPrice*item.qty).toFixed(2)}</div>\n            </div>\n            <button class="cart-modal__item-remove" title="Remove item" data-idx="${idx}">&times;</button>\n        `;cartModalItems.appendChild(el)});cartModalTotal.textContent=`$${total.toFixed(2)}`}function openCartModal(){renderCartModal();cartModal.classList.add("active");cartModal.style.display="flex";document.body.style.overflow="hidden"}function closeCartModal(){cartModal.classList.remove("active");cartModal.style.display="none";document.body.style.overflow=""}cartButton.addEventListener("click",openCartModal);cartModalOverlay.addEventListener("click",closeCartModal);cartModalClose.addEventListener("click",closeCartModal);document.addEventListener("keydown",e=>{if(cartModal.classList.contains("active")&&(e.key==="Escape"||e.key==="Esc"))closeCartModal()});cartModalItems.addEventListener("click",function(e){if(e.target.classList.contains("cart-modal__item-remove")){const idx=+e.target.getAttribute("data-idx");cart.splice(idx,1);updateCartBadge();renderCartModal()}});cartModalClear.addEventListener("click",function(){cart=[];updateCartBadge();renderCartModal()});function setupMenuItemModal(){const modal=document.getElementById("menu-modal");const modalImg=modal.querySelector(".menu-modal__image");const modalName=modal.querySelector(".menu-modal__name");const modalDesc=modal.querySelector(".menu-modal__description");const modalPrice=modal.querySelector(".menu-modal__price");const closeBtn=modal.querySelector(".menu-modal__close");const overlay=modal.querySelector(".menu-modal__overlay");const addToCartBtn=modal.querySelector(".menu-modal__add-to-cart");let qtyWrapper=modal.querySelector(".menu-modal__qty-wrapper");if(!qtyWrapper){qtyWrapper=document.createElement("div");qtyWrapper.className="menu-modal__qty-wrapper";qtyWrapper.innerHTML=`\n            <button type="button" class="menu-modal__qty-minus">-</button>\n            <span class="menu-modal__qty-value">1</span>\n            <button type="button" class="menu-modal__qty-plus">+</button>\n        `;addToCartBtn.parentElement.insertBefore(qtyWrapper,addToCartBtn)}const qtyValue=qtyWrapper.querySelector(".menu-modal__qty-value");const qtyMinus=qtyWrapper.querySelector(".menu-modal__qty-minus");const qtyPlus=qtyWrapper.querySelector(".menu-modal__qty-plus");function resetQty(){qtyValue.textContent="1"}qtyMinus.onclick=()=>{let val=parseInt(qtyValue.textContent,10);if(val>1)qtyValue.textContent=val-1};qtyPlus.onclick=()=>{let val=parseInt(qtyValue.textContent,10);qtyValue.textContent=val+1};function openModal({img:img,name:name,desc:desc,price:price}){modalImg.src=img.src;modalImg.alt=img.alt||name;modalName.textContent=name;modalDesc.textContent=desc||"";modalDesc.style.display=desc?"":"none";modalPrice.textContent=price!==undefined&&price!==null?`$${Number(price).toFixed(2)}`:"";modalPrice.setAttribute("data-price",price);modal.classList.add("active");modal.style.display="flex";document.body.style.overflow="hidden";resetQty()}function closeModal(){modal.classList.remove("active");modal.style.display="none";document.body.style.overflow=""}closeBtn.addEventListener("click",closeModal);overlay.addEventListener("click",closeModal);document.addEventListener("keydown",e=>{if(modal.classList.contains("active")&&(e.key==="Escape"||e.key==="Esc"))closeModal()});if(addToCartBtn){addToCartBtn.onclick=function(){const name=modalName.textContent;const price=parseFloat(modalPrice.getAttribute("data-price"));const img=modalImg.src;const qty=parseInt(qtyValue.textContent,10)||1;const idx=cart.findIndex(i=>i.name===name&&i.price===price&&i.img===img);if(idx>-1){cart[idx].qty+=qty}else{cart.push({name:name,price:price,img:img,qty:qty})}updateCartBadge();const originalText=addToCartBtn.textContent;addToCartBtn.textContent="ENJOY!";addToCartBtn.style.backgroundColor="var(--textSecondary)";addToCartBtn.style.color="white";addToCartBtn.style.transform="scale(1.05)";setTimeout(()=>{addToCartBtn.textContent=originalText;addToCartBtn.style.backgroundColor="";addToCartBtn.style.color="";addToCartBtn.style.transform="";resetQty()},1e3)}}document.querySelectorAll(".menu-item").forEach(item=>{const img=item.querySelector(".menu-item__image");const name=item.querySelector(".menu-item__name");const desc=item.querySelector(".menu-item__description");const price=item.querySelector(".menu-item__price");let priceValue=0;if(price){priceValue=parseFloat((price.textContent||"").replace(/[^\d.]/g,""))}function show(){openModal({img:img,name:name?name.textContent:"",desc:desc?desc.textContent:"",price:priceValue})}item.style.cursor="pointer";item.addEventListener("click",show)})}document.addEventListener("DOMContentLoaded",setupMenuItemModal)}document.addEventListener("DOMContentLoaded",function(){updateCartBadge();document.documentElement.style.scrollBehavior="smooth";const header=document.querySelector(".header");let lastScrollTop=0;window.addEventListener("scroll",function(){const scrollTop=window.pageYOffset||document.documentElement.scrollTop;if(scrollTop>lastScrollTop&&scrollTop>100){header.style.transform="translateY(-100%)"}else{header.style.transform="translateY(0)"}lastScrollTop=scrollTop})});document.addEventListener("DOMContentLoaded",function(){const hamburgerBtn=document.querySelector(".hamburger-btn");const navOverlay=document.getElementById("navOverlay");const navOverlayClose=document.getElementById("navOverlayClose");const navOverlayLinks=document.querySelectorAll(".nav-overlay__link");const menuSection=document.getElementById("menuSections");const footer=document.querySelector(".choco-footer");const cartButton=document.querySelector(".cart-btn");if(hamburgerBtn&&navOverlay&&navOverlayClose){function openNavOverlay(){navOverlay.style.display="flex";setTimeout(()=>navOverlay.classList.add("open"),10);navOverlay.setAttribute("aria-hidden","false");document.body.style.overflow="hidden"}function closeNavOverlay(){navOverlay.classList.remove("open");navOverlay.setAttribute("aria-hidden","true");setTimeout(()=>{navOverlay.style.display="none";document.body.style.overflow=""},350)}hamburgerBtn.addEventListener("click",function(e){e.preventDefault();if(navOverlay.classList.contains("open")){closeNavOverlay()}else{openNavOverlay()}});navOverlayClose.addEventListener("click",closeNavOverlay);document.addEventListener("keydown",function(e){if(navOverlay.classList.contains("open")&&(e.key==="Escape"||e.key==="Esc"))closeNavOverlay()});navOverlayLinks.forEach(link=>{link.addEventListener("click",function(e){const href=link.getAttribute("href");const nav=link.getAttribute("data-nav");if(href&&href!=="#"&&!nav){return}e.preventDefault();closeNavOverlay();if(nav==="menu"&&menuSection){menuSection.scrollIntoView({behavior:"smooth",block:"start"})}else if(nav==="contact"&&footer){footer.scrollIntoView({behavior:"smooth",block:"start"})}else if(nav==="cart"&&cartButton){cartButton.click()}})})}});const menuBtn=document.querySelector(".menu-btn");if(menuBtn){menuBtn.addEventListener("click",function(){menuBtn.style.transform="scale(0.98)";setTimeout(()=>{menuBtn.style.transform=""},150);console.log("Menu button clicked - menu functionality to be implemented")})}document.addEventListener("DOMContentLoaded",function(){const images=document.querySelectorAll("img");if("IntersectionObserver"in window){const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img.src=img.src;imageObserver.unobserve(img)}})});images.forEach(img=>imageObserver.observe(img))}});function setupMenuSectionToggles(){const sections=document.querySelectorAll(".menu-section");if(sections.length===0)return;sections.forEach(section=>{const header=section.querySelector(".menu-section__header");const toggle=section.querySelector(".menu-section__toggle");const items=section.querySelector(".menu-items");if(!header||!toggle||!items)return;items.style.maxHeight=items.scrollHeight+"px";header.addEventListener("click",e=>{if(e.target.closest(".menu-section__toggle")){return}const isClosed=section.classList.toggle("closed");if(isClosed){items.style.maxHeight="0px";if(section.id==="drinks"){section.querySelectorAll(".menu-subsection").forEach(sub=>{sub.classList.add("closed");sub.style.display="none"})}}else{items.style.maxHeight=items.scrollHeight+"px";if(section.id==="drinks"){section.querySelectorAll(".menu-subsection").forEach(sub=>{sub.style.display=""})}}});toggle.addEventListener("click",e=>{const isClosed=section.classList.toggle("closed");if(isClosed){items.style.maxHeight="0px";if(section.id==="drinks"){section.querySelectorAll(".menu-subsection").forEach(sub=>{sub.classList.add("closed");sub.style.display="none"})}}else{items.style.maxHeight=items.scrollHeight+"px";if(section.id==="drinks"){section.querySelectorAll(".menu-subsection").forEach(sub=>{sub.style.display=""})}}})})}document.addEventListener("DOMContentLoaded",setupMenuSectionToggles);document.addEventListener("DOMContentLoaded",function(){const viewMenuBtn=document.querySelector(".menu-btn");const contactBtn=document.querySelector(".contact-btn");const menuSection=document.getElementById("menuSections");const footer=document.querySelector(".choco-footer");if(viewMenuBtn&&menuSection){viewMenuBtn.addEventListener("click",function(e){e.preventDefault();viewMenuBtn.style.transform="scale(0.98)";setTimeout(()=>{viewMenuBtn.style.transform=""},150);menuSection.scrollIntoView({behavior:"smooth",block:"start"})})}if(contactBtn&&footer){contactBtn.addEventListener("click",function(e){e.preventDefault();contactBtn.style.transform="scale(0.98)";setTimeout(()=>{contactBtn.style.transform=""},150);footer.scrollIntoView({behavior:"smooth",block:"start"})})}});document.addEventListener("DOMContentLoaded",function(){const carousel=document.getElementById("featuredCarousel");if(!carousel)return;const slides=carousel.querySelectorAll(".featured-slide");const leftArrow=document.getElementById("featuredArrowLeft");const rightArrow=document.getElementById("featuredArrowRight");let current=0;let interval;function showSlide(idx){slides[current].classList.remove("active");current=(idx+slides.length)%slides.length;slides[current].classList.add("active")}function nextSlide(){showSlide(current+1)}function prevSlide(){showSlide(current-1)}function startAuto(){interval=setInterval(nextSlide,3500)}function resetAuto(){clearInterval(interval);startAuto()}if(leftArrow&&rightArrow){leftArrow.addEventListener("click",function(){prevSlide();resetAuto()});rightArrow.addEventListener("click",function(){nextSlide();resetAuto()})}startAuto()});if(!document.getElementById("modal-qty-style")){const style=document.createElement("style");style.id="modal-qty-style";style.textContent=`\n    .menu-modal__qty-wrapper {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 12px;\n      margin-bottom: 18px;\n      margin-top: 8px;\n    }\n    .menu-modal__qty-minus, .menu-modal__qty-plus {\n      background: #fff6ee;\n      color: var(--textSecondary);\n      border: 2px solid #e7d7c9;\n      border-radius: 50%;\n      width: 36px;\n      height: 36px;\n      font-size: 1.5rem;\n      font-weight: 900;\n      cursor: pointer;\n      transition: background 0.2s, color 0.2s, border 0.2s;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      outline: none;\n    }\n    .menu-modal__qty-minus:hover, .menu-modal__qty-plus:hover {\n      background: var(--textSecondary);\n      color: #fff;\n      border-color: var(--textSecondary);\n    }\n    .menu-modal__qty-value {\n      min-width: 32px;\n      text-align: center;\n      font-size: 1.25rem;\n      font-weight: 700;\n      color: var(--textSecondary);\n      background: none;\n      border: none;\n      pointer-events: none;\n    }\n  `;document.head.appendChild(style)}function setupMenuSubsectionToggles(){const subsections=document.querySelectorAll(".menu-section#drinks .menu-subsection");if(subsections.length===0)return;subsections.forEach(subsection=>{const header=subsection.querySelector(".menu-subsection__header");const toggle=subsection.querySelector(".menu-subsection__toggle");const items=subsection.nextElementSibling;if(!header||!toggle)return;let itemsDiv=subsection.querySelector(".menu-items");if(!itemsDiv)itemsDiv=items;if(!itemsDiv)return;itemsDiv.style.maxHeight=subsection.classList.contains("closed")?"0px":itemsDiv.scrollHeight+"px";function toggleSubcat(){const isClosed=subsection.classList.toggle("closed");if(isClosed){itemsDiv.style.maxHeight="0px"}else{itemsDiv.style.maxHeight=itemsDiv.scrollHeight+"px"}}header.addEventListener("click",e=>{if(e.target.closest(".menu-subsection__toggle"))return;toggleSubcat()});toggle.addEventListener("click",e=>{toggleSubcat()})})}document.addEventListener("DOMContentLoaded",function(){const navContainer=document.querySelector(".category-nav__container");const menuSections=document.getElementById("menuSections");if(!navContainer||!menuSections)return;let currentCategory=null;navContainer.addEventListener("click",async function(e){const tab=e.target.closest(".category-tab");if(!tab)return;e.preventDefault();if(tab.classList.contains("active"))return;navContainer.querySelectorAll(".category-tab").forEach(t=>t.classList.remove("active"));tab.classList.add("active");tab.style.transition="background 0.3s, color 0.3s, transform 0.2s";tab.style.transform="scale(1.08)";setTimeout(()=>{tab.style.transform=""},180);const filter=tab.getAttribute("href").replace("#","");if(currentCategory===filter)return;currentCategory=filter;const items=await fetchMenuItems();renderMenu(items,filter==="all"?null:filter);setTimeout(()=>{const section=document.getElementById(filter);if(section){section.classList.remove("closed");section.scrollIntoView({behavior:"smooth",block:"start"})}},100)})});